# タスクスケジューラ権限問題の修正手順

## 🔧 問題: 「オペレーターまたは管理者が拒否しました」

この問題は主に権限設定が原因です。以下の手順で修正してください：

## 📝 修正手順

### 1. タスクスケジューラを管理者権限で開く
```
1. Windowsキー + R
2. "taskschd.msc" と入力してEnter
3. UAC(ユーザーアカウント制御)で「はい」をクリック
```

### 2. 既存タスクの削除
```
1. 左側で "タスクスケジューラライブラリ" を選択
2. 「漢字クイズ自動動画投稿・分析アップロード」タスクを右クリック
3. "削除" を選択
4. 確認ダイアログで「はい」
```

### 3. 新しいタスクの作成
```
1. 右側の「タスクの作成...」をクリック
2. 「全般」タブ:
   - 名前: KanjiQuizDaily
   - 説明: Kanji Quiz Bot Daily Execution
   - ユーザーアカウント: [現在のユーザー名]
   - ✅ 「ユーザーがログオンしているかどうかにかかわらず実行する」
   - ✅ 「最上位の特権で実行する」
   - 構成: Windows 10

3. 「トリガー」タブ:
   - "新規..." をクリック
   - 開始: 毎日
   - 開始時刻: 07:00:00
   - ✅ 有効
   - OK

4. 「操作」タブ:
   - "新規..." をクリック
   - 操作: プログラムの開始
   - プログラム/スクリプト: D:\Python\KanjiQuiz\run_quiz_bot.bat
   - 開始場所: D:\Python\KanjiQuiz
   - OK

5. 「条件」タブ:
   - ❌ 「コンピューターが電源に接続されている場合のみタスクを開始する」のチェックを外す
   - ✅ 「スリープを解除してタスクを実行する」にチェック

6. 「設定」タブ:
   - ✅ 「タスクを要求時に実行を許可する」
   - ✅ 「スケジュールされた開始時刻にタスクが実行されなかった場合、すぐに実行する」
   - 失敗の場合: 1分間隔で最大3回再試行
   - ❌ 「タスクが既に実行中の場合は、新しいインスタンスを開始しない」

7. OK をクリック
8. パスワードの入力が求められたら、Windowsログインパスワードを入力
```

### 4. テスト実行
```
1. 作成したタスク「KanjiQuizDaily」を右クリック
2. "実行" を選択
3. 状態が "実行中" になることを確認
4. 数分後にログファイルが生成されることを確認
```

## 🚨 トラブルシューティング

### エラーが続く場合:
1. **バッチファイルパスの確認**
   ```
   D:\Python\KanjiQuiz\run_quiz_bot.bat が存在するか確認
   ```

2. **実行権限の確認**
   ```
   右クリック → プロパティ → セキュリティタブで実行権限を確認
   ```

3. **パスワードの再設定**
   ```
   タスクを右クリック → プロパティ → 全般タブ → パスワード変更
   ```

4. **ログ確認**
   ```
   logs\last_run.log を確認してエラー詳細を把握
   ```

## ✅ 成功確認
- タスクスケジューラでタスクの状態が "準備完了" 
- 最終実行時刻が更新されている
- LastTaskResult が 0 (成功) になっている
- ログファイルが正常に生成されている

## 📞 サポート
問題が解決しない場合、以下を確認してください：
1. Windowsユーザーアカウントの権限
2. ウイルス対策ソフトの実行ブロック
3. Pythonの仮想環境パス