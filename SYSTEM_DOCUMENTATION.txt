===============================================================================
                        WisdomShorts 自動化システム仕様書
===============================================================================

システム概要:
心に響く短編動画を自動生成・投稿するAI駆動の完全自動化システム

作成日: 2025-09-29
対象: 他システムでのGitHub自動アクション実装用

===============================================================================
                                システム構成
===============================================================================

1. プラットフォーム・技術スタック
   - 言語: Python 3.11
   - 実行環境: GitHub Actions (Ubuntu Latest)
   - 外部サービス連携: Google Cloud APIs, YouTube Data API, Discord Webhooks
   - 音声・動画処理: FFmpeg, MoviePy
   - AI: Google Gemini API
   - データ管理: Google Sheets, Google Drive

2. ファイル構造
   WisdomShorts/
   ├── .github/workflows/
   │   └── complete-automation.yml        # メイン自動化ワークフロー
   ├── app/                              # コアアプリケーション
   │   ├── generate_and_queue.py         # スクリプト生成・キューイング
   │   ├── collect_metrics.py            # YouTube統計収集
   │   ├── audio_processor.py            # 音楽処理・フェードアウト
   │   ├── google_drive.py               # Google Drive API
   │   ├── google_sheets.py              # Google Sheets API
   │   ├── youtube_api.py                # YouTube API
   │   ├── llm_gemini.py                 # Gemini AI統合
   │   ├── scheduler.py                  # 投稿スケジューラー
   │   ├── learning.py                   # AI学習システム
   │   └── text_utils.py                 # テキスト処理
   ├── process_uploaded_videos.py        # MP4処理メインスクリプト
   ├── mp3/                              # 背景音楽ファイル
   ├── 背景動画/                          # 背景映像素材
   ├── requirements.txt                  # Python依存関係
   └── .env.clean                        # 環境変数テンプレート

===============================================================================
                              自動化ワークフロー
===============================================================================

実行スケジュール:
- 自動実行: 毎日 06:00 JST (UTC 21:00 前日)
- 手動実行: GitHub ActionsのWorkflow Dispatch

ワークフロー3ステップ:

1. ステップ1: スクリプト生成・MP4処理
   - 新しい動画スクリプト生成 (デフォルト2本)
   - MP4ファイル検出・音楽追加
   - YouTube自動投稿・スケジューリング

2. ステップ2: データ検証・整合性チェック
   - スプレッドシートデータ検証
   - YouTube動画ステータス確認
   - データクリーンアップ

3. ステップ3: メトリクス収集
   - YouTube動画統計収集
   - パフォーマンス分析
   - AI学習データ更新

===============================================================================
                            必要な環境変数・Secrets
===============================================================================

GitHub Secrets設定一覧:

1. Google Cloud関連
   - GCP_SA_JSON: サービスアカウントJSONキー (フル)
   - GEMINI_API_KEY: Gemini API キー

2. Google Drive/Sheets
   - SHEET_ID: スプレッドシートID
   - CONFIG_FOLDER_ID: 設定フォルダID
   - SHORTS_ROOT_ID: ショート動画ルートフォルダID

3. YouTube OAuth
   - YT_REFRESH_TOKEN: YouTube OAuth リフレッシュトークン
   - YT_CLIENT_ID: YouTube OAuth クライアントID
   - YT_CLIENT_SECRET: YouTube OAuth クライアントシークレット

===============================================================================
                              外部サービス連携
===============================================================================

1. Google Cloud APIs (有効化必要)
   - Google Drive API
   - Google Docs API
   - Google Sheets API
   - YouTube Data API v3
   - Gemini AI API

2. Discord通知システム
   - Webhook URL: 実行状況・結果の詳細レポート送信
   - 通知タイミング: 開始時、各ステップ完了時、最終レポート

3. YouTube自動投稿
   - OAuth認証による自動アップロード
   - スケジュール投稿設定
   - メタデータ自動設定

===============================================================================
                              依存関係 (requirements.txt)
===============================================================================

google-api-python-client==2.145.0
google-auth==2.29.0
google-auth-httplib2==0.2.0
google-auth-oauthlib==1.2.0
google-generativeai==0.8.1
gspread==6.1.2
oauth2client==4.1.3
pandas==2.2.2
numpy==1.26.4
nltk==3.8.1
python-dateutil==2.9.0.post0
pytz==2024.1
tenacity==8.4.2
requests==2.32.3
jinja2==3.1.4
python-dotenv==1.0.0
moviepy==1.0.3

システム依存関係:
- FFmpeg (音声・動画処理)
- MeCab (日本語テキスト処理、オプション)

===============================================================================
                             実装のポイント
===============================================================================

1. GitHub Actions設定
   - Python 3.11環境
   - pip cache有効化
   - continue-on-error: true (部分的失敗許容)
   - 並列実行なし (シーケンシャル実行)

2. エラーハンドリング
   - 各ステップ独立実行
   - 失敗時も後続ステップ継続
   - Discord通知でステータス報告

3. 音楽処理機能
   - MP4動画長に合わせた音楽調整
   - 2秒フェードアウト処理
   - 音量50%設定
   - mp3フォルダからランダム選択

4. AI学習機能
   - 高・低パフォーマンス動画分析
   - Geminiによる継続学習
   - スクリプト生成品質向上

===============================================================================
                              セキュリティ考慮事項
===============================================================================

1. Secrets管理
   - 全ての認証情報をGitHub Secretsで管理
   - .env.cleanはテンプレートのみ (実際の値なし)
   - 本番環境変数は環境から直接取得

2. API制限対応
   - YouTube API: 1日10,000クォータ
   - Gemini API: リクエスト制限あり
   - 適切なretry機構実装

3. ファイル権限
   - Google Drive共有設定
   - サービスアカウント権限最小化

===============================================================================
                               他システム移行手順
===============================================================================

1. 事前準備
   - Google Cloud プロジェクト作成
   - 必要API有効化
   - サービスアカウント作成・JSON取得
   - YouTube OAuth設定

2. GitHub設定
   - リポジトリ作成
   - Secrets設定 (上記リスト参照)
   - ワークフローファイル配置

3. Google Drive構成
   - WisdomShorts フォルダ作成
   - config/ サブフォルダ作成
   - shorts/ サブフォルダ作成
   - 適切な共有権限設定

4. スプレッドシート設定
   - 専用シート作成
   - 列構成設定 (Frame01-20は右端)
   - サービスアカウントに編集権限付与

5. Discord設定
   - Webhookチャンネル作成
   - Webhook URL取得・設定

6. テスト実行
   - 手動Workflow Dispatch実行
   - 各ステップ動作確認
   - Discord通知確認

===============================================================================
                              カスタマイズポイント
===============================================================================

1. スケジュール変更
   - complete-automation.yml の cron設定変更
   - タイムゾーン考慮 (JST = UTC-9)

2. バッチサイズ調整
   - BATCH_SIZE環境変数
   - デフォルト: 2本/回

3. Discord通知カスタマイズ
   - Webhook URL変更
   - 通知内容・フォーマット調整

4. 音楽・映像素材
   - mp3/ フォルダに音楽ファイル配置
   - 背景動画/ フォルダに映像素材配置

===============================================================================
                              監視・運用
===============================================================================

1. 実行ログ確認
   - GitHub Actions実行履歴
   - アーティファクト (ログファイル、7日間保持)
   - GitHub Step Summary

2. 外部監視
   - Discord通知によるリアルタイム監視
   - Google Sheetsでのデータ状況確認
   - YouTube Studioでの動画状況確認

3. 障害対応
   - 部分的失敗時の手動リトライ
   - API制限時の待機・再実行
   - 認証エラー時のトークン更新

===============================================================================

この仕様書は他システムでのGitHub自動アクション実装時の
参考資料として使用してください。

作成者: Claude Code
最終更新: 2025-09-29
===============================================================================